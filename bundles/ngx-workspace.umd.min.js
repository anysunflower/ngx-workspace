!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("element-resize-detector"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs","element-resize-detector","@angular/common"],t):t((e.ngx=e.ngx||{},e.ngx.workspace={}),e.ng.core,null,null,e.ng.common)}(this,function(e,n,t,i,o){"use strict";var s,r;i=i&&i.hasOwnProperty("default")?i.default:i,(r=s||(s={}))[r.ASK_FOR_UNIT_HEIGHT=0]="ASK_FOR_UNIT_HEIGHT",r[r.ASK_FOR_DRAG_SCALE=1]="ASK_FOR_DRAG_SCALE",r[r.ASK_FOR_EDIT_MODE=2]="ASK_FOR_EDIT_MODE",r[r.ASK_FOR_EXTENDING_WORKBOARD=3]="ASK_FOR_EXTENDING_WORKBOARD";var a=function(){function e(){this.messageSource=new t.BehaviorSubject({type:null,payload:null}),this.currentMessage=this.messageSource.asObservable()}return e.prototype.sendMessage=function(e){this.messageSource.next(e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),h=function(){function e(e,t){this.cdr=e,this.dataService=t,this.unitHeight=0,this.responsiveMode=!0}return e.prototype.ngOnInit=function(){var t=this;this.dataService.currentMessage.subscribe(function(e){switch(e.type){case s.ASK_FOR_EDIT_MODE:return void(t.enableEditMode||t.autoBoardHeight());case s.ASK_FOR_EXTENDING_WORKBOARD:return void t.extendDragboard()}})},e.prototype.ngAfterViewInit=function(){var t=this;window.innerWidth<this.responsiveMinimalWidth&&(this.responsiveMode=!1),this.unitHeight=this.boardElement.nativeElement.offsetWidth/12,this.dragScale={left:this.boardElement.nativeElement.offsetLeft,right:this.boardElement.nativeElement.offsetWidth+this.boardElement.nativeElement.offsetLeft,top:this.boardElement.nativeElement.offsetTop,bottom:0},this.autoBoardHeight(),this.boardElement.nativeElement.style.width="100%",this.boardElement.nativeElement.style.position="relative",this.cdr.detectChanges();var e=12*Math.round(this.boardElement.nativeElement.offsetHeight/this.unitHeight+.49);this.updateGrids(e),this.workspaceResizeDetector=i(),this.workspaceResizeDetector.listenTo(this.boardElement.nativeElement,function(e){t.onWindowResize()})},e.prototype.ngOnDestroy=function(){this.enableEditMode=!1,this.workspaceResizeDetector.removeAllListeners(this.boardElement.nativeElement)},e.prototype.onWindowResize=function(){window.innerWidth<this.responsiveMinimalWidth?(this.responsiveMode=!1,this.enableEditMode=!1):this.responsiveMode=!0;var e=this.boardElement.nativeElement.offsetWidth/12;e!==this.unitHeight&&(this.unitHeight=e,this.autoBoardHeight(),this.updateGridSize(),this.dragScale.right=this.boardElement.nativeElement.offsetWidth+this.boardElement.nativeElement.offsetLeft),this.cdr.detectChanges()},e.prototype.autoBoardHeight=function(){for(var e=0,t=0,i=this.tiles;t<i.length;t++){var n=i[t];n.unitHeight+n.offsetTopUnit>e&&(e=n.unitHeight+n.offsetTopUnit)}this.boardElement.nativeElement.style.minHeight=this.unitHeight*e+24+"px"},e.prototype.updateGridSize=function(){for(var e=0,t=this.backgroundRef.nativeElement.querySelectorAll(".grid");e<t.length;e++){var i=t[e];i.style.height=this.unitHeight+"px",i.style.width=this.unitHeight+"px"}},e.prototype.updateGrids=function(e){if(e<0)for(var t=this.backgroundRef.nativeElement.querySelectorAll(".grid"),i=0;i<-e;i++)t[i].remove();else{var n=document.createElement("li");n.className+="grid",n.style.height=this.unitHeight+"px",n.style.width=this.unitHeight+"px",n.innerHTML="<span></span>";for(i=0;i<e;i++)this.backgroundRef.nativeElement.appendChild(n.cloneNode(!0))}},e.prototype.extendDragboard=function(){var e=this.boardElement.nativeElement.offsetHeight+4*this.unitHeight;this.boardElement.nativeElement.style.minHeight=e+"px",this.updateGrids(48)},e.decorators=[{type:n.Component,args:[{selector:"ngx-workboard",templateUrl:"./ngx-workboard.component.html",styleUrls:["./ngx-workboard.component.scss"]}]}],e.ctorParameters=function(){return[{type:n.ChangeDetectorRef},{type:a}]},e.propDecorators={tiles:[{type:n.Input,args:["widgets"]}],responsiveMinimalWidth:[{type:n.Input,args:["screenMinWidth"]}],boardElement:[{type:n.ViewChild,args:["workboard"]}],backgroundRef:[{type:n.ViewChild,args:["background"]}]},e}(),l=function(){function e(){this.tiles=[]}return e.prototype.initTileOptions=function(e){void 0===e.overlapped&&(e.overlapped=!1),void 0===e.highlighted&&(e.highlighted=!1)},Object.defineProperty(e.prototype,"Tiles",{get:function(){return this.tiles},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this.initTileOptions(e),this.tiles.push(e)},e.prototype.remove=function(t){var e=this.tiles.findIndex(function(e){return t.name===e.name});0<=e&&this.tiles.splice(e,1)},e.prototype.tilesOverlappedWithOthers=function(e){e=e||this.tiles;for(var t=[],i=0;i<e.length;i++)for(var n=e[i],o=i+1;o<e.length;o++){var s=e[o],r={begin:{X:n.offsetLeftUnit,Y:n.offsetTopUnit},end:{X:n.offsetLeftUnit+n.unitWidth,Y:n.offsetTopUnit+n.unitHeight}},a={begin:{X:s.offsetLeftUnit,Y:s.offsetTopUnit},end:{X:s.offsetLeftUnit+s.unitWidth,Y:s.offsetTopUnit+s.unitHeight}};this.isInsideAreaOf(a,r)&&(t.includes(i)||t.push(i),t.push(o))}return t},e.prototype.isInsideAreaOf=function(e,t){return t.end.X>e.begin.X&&t.begin.X<e.end.X&&t.end.Y>e.begin.Y&&t.begin.Y<e.end.Y},e.prototype.isShadowCoveredOnTiles=function(e,t){for(var i=0,n=this.tiles;i<n.length;i++){var o=n[i];if(o.name!==e){var s={begin:{X:o.offsetLeftUnit,Y:o.offsetTopUnit},end:{X:o.offsetLeftUnit+o.unitWidth,Y:o.offsetTopUnit+o.unitHeight}};if(this.isInsideAreaOf(s,t))return!0}}return!1},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),p=function(){function e(e){this.viewContainerRef=e}return e.decorators=[{type:n.Directive,args:[{selector:"[ngx-workspace-loader]"}]}],e.ctorParameters=function(){return[{type:n.ViewContainerRef}]},e}(),d=function(){function e(e,t,i,n){this.cdr=e,this.dataService=t,this.dragService=i,this.componentFactoryResolver=n,this.elementChecked=!1,this.enableEditMode=!1,this.unitHeight=0,this.dataService.sendMessage({type:s.ASK_FOR_UNIT_HEIGHT,payload:!0})}return e.prototype.ngOnInit=function(){var t=this;this.dataService.currentMessage.subscribe(function(e){switch(e.type){case s.ASK_FOR_EDIT_MODE:return void(t.enableEditMode=e.payload);case s.ASK_FOR_UNIT_HEIGHT:return void(t.unitHeight=e.payload)}})},e.prototype.ngAfterViewInit=function(){this.loadApplicationComponent(),this.elementRef.nativeElement.id=this.tile.name},e.prototype.ngDoCheck=function(){if(this.tile.overlapped){this.elementRef.nativeElement.style.border="2px solid #f44336",this.elementRef.nativeElement.style.boxShadow="0 2px 4px -1px rgba(255,107,107, .2), 0 4px 5px 0 rgba(255,107,107, .14), 0 1px 10px 0 rgba(255,107,107, .12)"}else this.elementRef.nativeElement.style.border=null,this.elementRef.nativeElement.style.boxShadow=null;!this.elementChecked&&this.tile&&(this.elementChecked=!0,this.dragService.add(this.tile))},e.prototype.ngOnDestroy=function(){this.componentRef&&this.componentRef.destroy()},e.prototype.loadApplicationComponent=function(e){void 0===e&&(e=this.tile.name);var t=this.componentFactoryResolver.resolveComponentFactory(this.widgetComponent),i=this.widgetContainer.viewContainerRef;i.clear(),this.componentRef=i.createComponent(t)},Object.defineProperty(e.prototype,"getTileStyle",{get:function(){return this.responsiveMode?{position:"absolute",width:this.tile.unitWidth*this.unitHeight+"px",height:this.tile.unitHeight*this.unitHeight+"px",top:this.tile.offsetTopUnit*this.unitHeight+"px",left:this.tile.offsetLeftUnit*this.unitHeight+"px"}:{width:"100%"}},enumerable:!0,configurable:!0}),e.prototype.getAppProfile=function(e){return{unitHeight:this.unitHeight,tile:e}},e.prototype.getPosition=function(t){if(t.move&&this.responsiveMode){var e=this.dragService.Tiles.find(function(e){return e.name===t.tileName});t.move.X=Math.round(t.move.X/this.unitHeight),t.move.Y=Math.round(t.move.Y/this.unitHeight),e.offsetLeftUnit=t.move.X,e.offsetTopUnit=t.move.Y,t.move.X*=this.unitHeight,t.move.Y*=this.unitHeight,this.cdr.detectChanges();var i=this.dragService.tilesOverlappedWithOthers(this.dragService.Tiles);this.createOverlapNotification(i)}},e.prototype.createOverlapNotification=function(e){for(var t=0;t<this.dragService.Tiles.length;t++)this.dragService.Tiles[t].overlapped=!!e.includes(t)},e.decorators=[{type:n.Component,args:[{selector:"ngx-drag-element",templateUrl:"./ngx-drag-element.component.html",styleUrls:["./ngx-drag-element.component.scss"]}]}],e.ctorParameters=function(){return[{type:n.ChangeDetectorRef},{type:a},{type:l},{type:n.ComponentFactoryResolver}]},e.propDecorators={tile:[{type:n.Input,args:["tile"]}],widgetComponent:[{type:n.Input,args:["component"]}],responsiveMode:[{type:n.Input,args:["responsiveMode"]}],elementRef:[{type:n.ViewChild,args:["elementRef"]}],elementShadow:[{type:n.ViewChild,args:["elementShadow"]}],widgetContainer:[{type:n.ViewChild,args:[p]}]},e}(),u=function(){function e(e,t,i){this.el=e,this.dataService=t,this.dragService=i,this.isMouseDown=!1,this.lastPosition=null,this.appPosition=new n.EventEmitter,this.moveTo=null}return e.prototype.onMouseDown=function(e){this.appDraggable&&(this.el.nativeElement.style.zIndex=9999,this.el.nativeElement.style.borderLeft="thick solid #0000FF",this.isMouseDown=!0,this.lastPosition={X:e.clientX,Y:e.clientY},this.originalOffset={left:this.el.nativeElement.offsetLeft||0,top:this.el.nativeElement.offsetTop||0},this.appShadowElement.style.display="block")},e.prototype.onMouseUp=function(){this.isMouseDown&&(this.el.nativeElement.style.border=null,this.appPosition.emit({move:this.moveTo,tileName:this.appProfile.tile.name}),this.dragElementTo(this.moveTo),this.moveTo=null,this.isMouseDown=!1,this.resetPosition())},e.prototype.onMouseLeave=function(){this.isMouseDown&&(this.appPosition.emit({move:this.moveTo,tileName:this.appProfile.tile.name}),this.dragElementTo(this.moveTo),this.moveTo=null),this.isMouseDown=!1,this.resetPosition()},e.prototype.onMouseMove=function(e){if(this.appDraggable&&this.isMouseDown){this.moveTo={X:e.clientX-this.lastPosition.X,Y:e.clientY-this.lastPosition.Y},this.moveTo.X+=this.originalOffset.left,this.moveTo.Y+=this.originalOffset.top,this.moveTo.X=Math.max(this.moveTo.X,0),this.moveTo.X=Math.min(this.moveTo.X,this.draggableScale.right-this.draggableScale.left-this.el.nativeElement.offsetWidth),this.moveTo.Y=Math.max(this.moveTo.Y,0),this.dragElementTo(this.moveTo);var t={X:Math.round(this.moveTo.X/this.appProfile.unitHeight),Y:Math.round(this.moveTo.Y/this.appProfile.unitHeight)};this.moveElementShadowToByUnits(t);var i=this.dragService.isShadowCoveredOnTiles(this.appProfile.tile.name,{begin:t,end:{X:t.X+this.appProfile.tile.unitWidth,Y:t.Y+this.appProfile.tile.unitHeight}});this.appShadowElement.style.background=i?"rgba(255, 50, 0, 0.5)":"rgba(0, 21, 59, 0.3)",-(document.querySelector(".drag-board").clientHeight-this.el.nativeElement.offsetHeight-this.el.nativeElement.offsetTop)>=this.appProfile.unitHeight/2&&this.dataService.sendMessage({type:s.ASK_FOR_EXTENDING_WORKBOARD,payload:!0})}},e.prototype.dragElementTo=function(e){e&&(this.el.nativeElement.style.top=e.Y+"px",this.el.nativeElement.style.left=e.X+"px")},e.prototype.moveElementShadowToByUnits=function(e){e&&(this.appShadowElement.style.top=e.Y*this.appProfile.unitHeight+"px",this.appShadowElement.style.left=e.X*this.appProfile.unitHeight+"px")},e.prototype.resetPosition=function(){this.el.nativeElement.style.zIndex=null,this.appShadowElement.style.display=null},e.decorators=[{type:n.Directive,args:[{selector:"[appDraggable]"}]}],e.ctorParameters=function(){return[{type:n.ElementRef},{type:a},{type:l}]},e.propDecorators={appDraggable:[{type:n.Input}],draggableScale:[{type:n.Input,args:["appDragScale"]}],appProfile:[{type:n.Input,args:["appProfile"]}],appShadowElement:[{type:n.Input,args:["appShadow"]}],appPosition:[{type:n.Output,args:["appPosition"]}],onMouseDown:[{type:n.HostListener,args:["mousedown",["$event"]]}],onMouseUp:[{type:n.HostListener,args:["mouseup"]}],onMouseLeave:[{type:n.HostListener,args:["mouseleave"]}],onMouseMove:[{type:n.HostListener,args:["mousemove",["$event"]]}]},e}(),f=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[o.CommonModule],declarations:[d,h,u],providers:[l],exports:[h,d]}]}],e}();e.NgxWorkboardComponent=h,e.DragElementComponent=d,e.NgxWorkspaceModule=f,Object.defineProperty(e,"__esModule",{value:!0})});
